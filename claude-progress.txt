# microBPF Development Progress

## Project Summary
microBPF is a sandboxed, event-driven in-kernel programmability system for constrained
kernels (RTOS, microkernels, embedded). Uses MQuickJS as execution engine.
Defines: host ABI (helpers/maps), .mbpf package format, runtime resource model, hook model.

## Tasks Identified: 97 total
- Infrastructure: 12 (setup, tests, docs)
- Functional: 71 (package format, runtime, maps, helpers, hooks, toolchain)
- Security: 8 (signing, capabilities, isolation, fuzzing)
- Performance: 4 (ROM stdlib, lock-free reads, no-alloc paths)

## Recommended Architecture
- Language: C (for embedded compatibility and MQuickJS integration)
- Build: CMake or Makefile (cross-platform, embedded-friendly)
- MQuickJS: Git submodule or vendored copy
- Toolchain: Separate CLI tools in C or Python for .mbpf assembly
- Tests: Unity or custom C test framework; fuzzing via libFuzzer

## Current Status
NOT YET IMPLEMENTED. First working agent should start with "project-setup" task.

## Key Implementation Phases (from spec)
1. Runtime MVP: package parsing, single hook, step budgeting, log helper
2. Maps MVP: array + hash maps, JS map API
3. Attach API: hook registry, multiple programs, per-CPU instances
4. Signing: Ed25519 verification and policy engine
5. Observability: counters, debug symbols, event output
- 2024-12-24: Project setup complete with MQuickJS integration and build scaffolding.
- 2025-12-24: Package header parsing implemented (magic/version/header size/section count) and tests/tools added.
- 2025-12-24: Implemented .mbpf section descriptor parsing with bounds/overlap validation and added section table tests.
- 2025-12-24: Package manifest parsing completed with CBOR/JSON support and manifest tests.
- 2025-12-24: Bytecode section handling now validates, relocates, and loads MQuickJS bytecode with tests.
- 2025-12-24: Added CRC32 validation for package headers/sections with tests.
- 2025-12-24: Added Ed25519 package signature verification, header APIs, and signing tests.
- 2025-12-24: Reviewed and validated runtime init/shutdown APIs with runtime tests.
- 2025-12-24: Verified mbpf_program_load basic behavior with new program load tests.
- 2025-12-24: Completed program load validation checks (heap minimum enforcement) with comprehensive tests.
- 2025-12-24: Implemented mbpf_program_unload with mbpf_fini handling and added program unload tests.
- 2025-12-24: Implemented program attach/detach hook binding with runtime execution tests.
- 2025-12-24: Validated attach hook type and context ABI version checks with new attach validation tests.
instance-creation: reviewed and fixed per-CPU instance selection guard
- 2025-12-24: Reviewed runtime-run-basic; mbpf_run executes attached programs with new run tests.
- 2025-12-24: Completed runtime context object support with NET_RX field exposure and tests.
- 2025-12-24: Implemented ctx.readU8/readU16LE/readU32LE/readBytes with NET_RX tests.
- 2025-12-24: Reviewed NET_RX v1 context binding, flags exposure, and added context tests.
- 2025-12-24: Reviewed and validated MBPF_HOOK_TRACEPOINT context binding and tests.
- 2025-12-24: Reviewed and validated MBPF_HOOK_TIMER context binding and tests.
- 2025-12-24: Reviewed and validated MBPF_HOOK_NET_RX decision hook tests.
- 2025-12-24: Reviewed and validated MBPF_HOOK_NET_TX hook tests and context.
- 2025-12-24: Reviewed and validated MBPF_HOOK_SECURITY authorization hook with new security context tests.
- 2025-12-24: Reviewed and validated MBPF_HOOK_CUSTOM support with custom context accessors and tests.
entry-point-mbpf-prog: verified entry function required and called
entry-point-mbpf-init: verified optional mbpf_init load-time entry
entry-point-mbpf-fini: verified optional mbpf_fini unload entry
return-value-semantics: verified 32-bit signed return value handling
exception-handling: reviewed exception defaults and tests
- Completed map-array-basic review: array map lookup/update and tests added.
- Completed map-hash-basic review: added hash map lookup/update/delete and tests.
